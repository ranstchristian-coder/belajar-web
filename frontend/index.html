<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>YuRa Personal Finance</title>

  <link rel="stylesheet" href="style.css" />

  <!-- ExcelJS + FileSaver (untuk Export XLSX) -->
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <!-- jsPDF + autoTable (untuk export PDF detail) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Chart.js + Datalabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

</head>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0066cc">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<body data-theme="light">
  <div class="container">
    <!-- HEADER -->
    <header>
      <h1>YuRa Personal Finance</h1>

      <div class="theme-selector">
        <select id="theme-select">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="blue">Blue</option>
          <option value="green">Green</option>
        </select>
      </div>

      <div class="header-right">
        <label class="density">
          <span class="label">Density</span>
          <select id="densitySelect" title="Tingkat kerapatan UI">
            <option value="normal">Normal</option>
            <option value="compact">Compact</option>
            <option value="super">Super</option>
          </select>
        </label>

        <span id="userInfo"></span>
        <button id="logoutBtn" class="btn small outlined">Logout</button>
      </div>
    </header>


    <!-- DASHBOARD -->
    <section class="card dashboard">
      <div class="card-header flex items-center gap-2">
        <h2 id="dashboard-title">Dashboard Ringkasan</h2>
        <span class="ml-auto"></span>
        <label class="flex items-center gap-2">Periode:
          <select id="dashboard-range">
            <option value="7">7 Hari</option>
            <option value="30" selected>30 Hari</option>
            <option value="month">Bulan Ini</option>
          </select>
        </label>
        <label class="flex items-center gap-2">Tipe:
          <select id="dashboard-type">
            <option value="both" selected>Pemasukan & Pengeluaran</option>
            <option value="income">Pemasukan</option>
            <option value="expense">Pengeluaran</option>
          </select>
        </label>
      </div>

      <div class="kpi-grid">
        <div class="kpi tile">
          <h3 id="kpi-income-title">Pemasukan (30 Hari Terakhir)</h3>
          <div id="kpi-income-val">Rp 0</div>
        </div>
        <div class="kpi tile">
          <h3 id="kpi-expense-title">Pengeluaran (30 Hari Terakhir)</h3>
          <div id="kpi-expense-val">Rp 0</div>
        </div>
        <div class="kpi tile">
          <h3 id="kpi-balance-title">Saldo Bersih (30 Hari Terakhir)</h3>
          <div id="kpi-balance-val">Rp 0</div>
        </div>
        <div class="kpi tile">
          <h3 id="kpi-count-title">Jumlah Transaksi (30 Hari Terakhir)</h3>
          <div id="kpi-count-val">0</div>
        </div>
      </div>

      <div class="dashboard-extra">
        <div class="card chart-card">
          <h3>Distribusi Kategori</h3>
          <canvas id="categoryPie" height="260"></canvas>
          <ul id="top-categories" class="top-cat-list"></ul>
        </div>
        <div class="card chart-card">
          <h3 id="trend-title">Tren 30 Hari Terakhir</h3>
          <canvas id="weeklyLine" height="260"></canvas>
          <div class="weekly-total mt-3">
            <span id="weekly-label">30 Hari Terakhir:</span>
            <span id="week-income" class="ml-2">Rp 0</span> •
            <span id="week-expense" class="ml-2">Rp 0</span>
          </div>
        </div>
      </div>
    </section>

    <!-- GRAFIK GABUNGAN -->
    <section class="card chart-card">
      <h2>Grafik Pemasukan vs Pengeluaran</h2>
      <canvas id="combinedChart" height="260"></canvas>
    </section>

    <!-- FORM INPUT -->
    <section class="flex-row">
      <!-- Pemasukan -->
      <div class="card">
        <h3>Pemasukan</h3>
        <div class="form-row">
          <label>Jumlah (Rp)</label>
          <input type="number" id="income-amount" placeholder="0" />
        </div>
        <div class="form-row">
          <label>Tanggal</label>
          <input type="date" id="income-date" />
        </div>
        <div class="form-row">
          <label>Kategori</label>
          <select id="income-category"></select>
          <div class="mini-btn-group">
            <button id="add-income-cat" class="btn small outlined">+Kategori</button>
            <button id="remove-income-cat" class="btn small outlined danger">-Kategori</button>
          </div>
        </div>
        <div class="form-row">
          <label>Keterangan</label>
          <input type="text" id="income-note" placeholder="contoh: pembayaran pelanggan A" />
        </div>
        <button id="add-income" class="btn primary full">Tambah Pemasukan</button>
      </div>

      <!-- Pengeluaran -->
      <div class="card">
        <h3>Pengeluaran</h3>
        <div class="form-row">
          <label>Jumlah (Rp)</label>
          <input type="number" id="expense-amount" placeholder="0" />
        </div>
        <div class="form-row">
          <label>Tanggal</label>
          <input type="date" id="expense-date" />
        </div>
        <div class="form-row">
          <label>Kategori</label>
          <select id="expense-category"></select>
          <div class="mini-btn-group">
            <button id="add-expense-cat" class="btn small outlined">+Kategori</button>
            <button id="remove-expense-cat" class="btn small outlined danger">-Kategori</button>
          </div>
        </div>
        <div class="form-row">
          <label>Keterangan</label>
          <input type="text" id="expense-note" placeholder="contoh: beli perangkat wifi" />
        </div>
        <button id="add-expense" class="btn primary full">Tambah Pengeluaran</button>
      </div>
    </section>

    <!-- RINGKASAN + UNDO -->
    <section class="card">
      <h3>Ringkasan</h3>
      <div class="totals">
        <div>Total Pemasukan: <strong id="total-income">Rp 0</strong></div>
        <div>Total Pengeluaran: <strong id="total-expense">Rp 0</strong></div>
        <div>Saldo: <strong id="balance">Rp 0</strong></div>
      </div>
      <div class="undo-bar mt-3">
        <button id="undo-latest" class="btn small outlined" disabled>Undo Terakhir</button>
        <button id="undo-all" class="btn small outlined danger" disabled>Undo Semua</button>
        <span id="undo-timer" class="ml-auto muted"></span>
      </div>
    </section>

    <!-- DAFTAR TRANSAKSI -->
    <section class="flex-row">
      <div class="card">
        <h3>Daftar Pemasukan</h3>
        <ul id="income-list" class="tx-list"></ul>
      </div>
      <div class="card">
        <h3>Daftar Pengeluaran</h3>
        <ul id="expense-list" class="tx-list"></ul>
      </div>
    </section>

    <!-- FILTER & EXPORT -->
    <section class="card export-section">
      <h3>Filter & Export</h3>
      <div class="filters">
        <label>Dari <input type="date" id="filter-from" /></label>
        <label>Sampai <input type="date" id="filter-to" /></label>
        <button id="applyFilter" class="btn small outlined">Terapkan</button>
        <button id="resetFilter" class="btn small outlined">Reset</button>
      </div>
      <div class="export-row">
        <button id="exportCsv" class="btn small outlined">Export CSV</button>
        <button id="exportXlsx" class="btn small outlined">Export XLSX</button>
        <button id="btnPDF" class="btn">Export PDF (Filter)</button>
        <span class="muted">| Bulanan:</span>
        <select id="export-month"></select>
        <select id="export-year"></select>
        <label for="pdf-type-filter" style="margin-left:8px;">Tipe:</label>
      <select id="pdf-type-filter" class="input">
        <option value="both">Semua</option>
        <option value="income">Pemasukan</option>
        <option value="expense">Pengeluaran</option>
      </select>

        <button id="exportMonthCsv" class="btn small outlined">Export Bulanan CSV</button>
        <button id="exportMonthXlsx" class="btn small outlined">Export Bulanan XLSX</button>
        <button id="exportMonthPdf" class="btn">Export Bulanan PDF</button>
        <button id="exportMonthPdfDetail" class="btn">Export Bulanan PDF (Detail)</button>
      </div>
    </section>
  </div>

  <!-- EDIT MODAL -->
  <div id="editModal" class="modal hidden">
    <div class="modal-content">
      <h3>Edit Transaksi</h3>
      <input type="hidden" id="edit-id" />
      <div class="form-row">
        <label>Kategori</label>
        <input type="text" id="edit-category" />
      </div>
      <div class="form-row">
        <label>Jumlah (Rp)</label>
        <input type="number" id="edit-amount" />
      </div>
      <div class="form-row">
        <label>Tanggal</label>
        <input type="date" id="edit-date" />
      </div>
      <div class="form-row">
        <label>Keterangan</label>
        <input type="text" id="edit-note" />
      </div>
      <div class="flex gap-2 mt-3">
        <button id="saveEdit" class="btn primary">Simpan</button>
        <button id="cancelEdit" class="btn outlined">Batal</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>

    <!-- jsPDF + AutoTable -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js') // ← relatif
        .then(r => console.log('[SW] registered', r.scope))
        .catch(err => console.warn('[SW] failed', err));
    });
  }
</script>
</body>
</html>
